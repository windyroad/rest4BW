<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:ns2="http://windyroad.org/bwunit-abstract" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:ns1="http://www.tibco.com/pe/EngineTypes" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ns="http://www.tibco.com/pe/GenerateErrorActivity/InputSchema" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:tib="http://www.tibco.com/bw/xslt/custom-functions" xmlns:pfx2="http://windyroad.org/bwunit-0.0.0.xsd" xmlns:pfx="http://windyroad.org/RESTlib.xsd">
    <xsd:import namespace="http://windyroad.org/RESTlib.xsd" schemaLocation="/REST/Public/Schemas/RESTlib.xsd"/>
    <pd:name>REST/Public/Process/Http/root.process</pd:name>
    <pd:startName>Start</pd:startName>
    <pd:startType ref="pfx:request"/>
    <pd:startX>150</pd:startX>
    <pd:startY>64</pd:startY>
    <pd:returnBindings>
        <xsl:choose>
            <xsl:when test="$getStatic/pfx:response">
                <xsl:copy-of select="$getStatic/pfx:response"/>
            </xsl:when>
            <xsl:otherwise>
                <pfx:response>
                    <pfx:text-content>
                        <xsl:value-of select="tib:render-xml($Map-Data/bwunit, false(), true())"/>
                    </pfx:text-content>
                    <pfx:headers>
                        <xsl:attribute name="last-modified">
                            <xsl:value-of select="current-dateTime()"/>
                        </xsl:attribute>
                    </pfx:headers>
                </pfx:response>
            </xsl:otherwise>
        </xsl:choose>
    </pd:returnBindings>
    <pd:endName>End</pd:endName>
    <pd:endType ref="pfx:response"/>
    <pd:endX>891</pd:endX>
    <pd:endY>61</pd:endY>
    <pd:errorSchemas>
        <Error ref="pfx:error"/>
    </pd:errorSchemas>
    <pd:processVariables/>
    <pd:targetNamespace>http://xmlns.example.com/1324323245685</pd:targetNamespace>
    <pd:activity name="Map Data">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>621</pd:x>
        <pd:y>64</pd:y>
        <config>
            <element>
                <xsd:element name="bwunit">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="test-suite" minOccurs="0">
                                <xsd:complexType>
                                    <xsd:sequence/>
                                    <xsd:attribute name="name" type="xsd:string" use="required"/>
                                    <xsd:attribute name="href" type="xsd:anyURI" use="required"/>
                                </xsd:complexType>
                            </xsd:element>
                            <xsd:element name="license">
                                <xsd:complexType>
                                    <xsd:sequence/>
                                    <xsd:attribute name="href" type="xsd:anyURI" use="required"/>
                                </xsd:complexType>
                            </xsd:element>
                        </xsd:sequence>
                        <xsd:attribute name="href" type="xsd:anyURI" use="required"/>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <bwunit>
                <xsl:attribute xmlns:xsl="http://www.w3.org/1999/XSL/Transform" name="href">
                    <xsl:value-of select="concat('http://', $Start/pfx:request/pfx:host)"/>
                </xsl:attribute>
                <test-suite>
                    <xsl:attribute name="name">
                        <xsl:value-of select="$_processContext/ns1:ProcessContext/ProjectName"/>
                    </xsl:attribute>
                    <xsl:attribute name="href">
                        <xsl:value-of select="concat('http://', $Start/pfx:request/pfx:host, '/test-suite/', $_processContext/ns1:ProcessContext/ProjectName)"/>
                    </xsl:attribute>
                </test-suite>
                <license>
                    <xsl:attribute xmlns:xsl="http://www.w3.org/1999/XSL/Transform" name="href">
                        <xsl:value-of select="concat('http://', $Start/pfx:request/pfx:host, '/license')"/>
                    </xsl:attribute>
                </license>
            </bwunit>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="getStatic">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>621</pd:x>
        <pd:y>187</pd:y>
        <config>
            <processName>/REST/Public/Process/Http/getStatic.process</processName>
        </config>
        <pd:inputBindings>
            <input>
                <path>/index.html</path>
                <xsl:if test="$Start/pfx:request/@if-modified-since">
                    <if-modified-since>
                        <xsl:value-of select="$Start/pfx:request/@if-modified-since"/>
                    </if-modified-since>
                </xsl:if>
            </input>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="405">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>154</pd:x>
        <pd:y>244</pd:y>
        <config>
            <processName>/REST/Public/StatusCodes/405 Method Not Allowed.process</processName>
        </config>
        <pd:inputBindings>
            <allow>GET</allow>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="FilterAccepts">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>308</pd:x>
        <pd:y>65</pd:y>
        <config>
            <element ref="pfx:accepts"/>
        </config>
        <pd:inputBindings>
            <xsl:variable name="acceptable">
                <acpt>application/vnd.org.windyroad.bwunit+xml</acpt>
                <acpt>text/html</acpt>
                <acpt>application/xhtml+xml</acpt>
                <acpt>*/*</acpt>
            </xsl:variable>
            <pfx:accepts>
                <xsl:for-each select="$Start/pfx:request/pfx:accepts/pfx:accept">
                    <xsl:if test="$acceptable/acpt[.=current()/@type]">
                        <pfx:accept>
                            <xsl:if test="@type">
                                <xsl:attribute name="type">
                                    <xsl:value-of select="@type"/>
                                </xsl:attribute>
                            </xsl:if>
                            <xsl:if test="@q">
                                <xsl:attribute name="q">
                                    <xsl:value-of select="@q"/>
                                </xsl:attribute>
                            </xsl:if>
                        </pfx:accept>
                    </xsl:if>
                </xsl:for-each>
            </pfx:accepts>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="406">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>313</pd:x>
        <pd:y>244</pd:y>
        <config>
            <processName>/REST/Public/StatusCodes/406 Not Acceptable.process</processName>
        </config>
        <pd:inputBindings>
            <pfx:request/>
        </pd:inputBindings>
    </pd:activity>
    <pd:transition>
        <pd:from>Start</pd:from>
        <pd:to>FilterAccepts</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>'GET'=$Start/pfx:request/pfx:method</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>Start</pd:from>
        <pd:to>405</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>otherwise</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>FilterAccepts</pd:from>
        <pd:to>getStatic</pd:to>
        <pd:xpathDescription>type=html,xhtml,xml</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>$FilterAccepts/pfx:accepts/pfx:accept[1]/@type="text/html"
or$FilterAccepts/pfx:accepts/pfx:accept[1]/@type="application/xhtml+xml"</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>FilterAccepts</pd:from>
        <pd:to>406</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>otherwise</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>getStatic</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Map Data</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>FilterAccepts</pd:from>
        <pd:to>Map Data</pd:to>
        <pd:xpathDescription>type=org.windyroad.bwunit</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>($FilterAccepts/pfx:accepts/pfx:accept[1]/@type="application/vnd.org.windyroad.bwunit+xml"
or $FilterAccepts/pfx:accepts/pfx:accept[1]/@type="*/*")
and (empty($FilterAccepts/pfx:accepts/pfx:accept/pfx:parameters[lower-case(@name)='charset'])
or lower-case($FilterAccepts/pfx:accepts/pfx:accept/pfx:parameters[lower-case(@name)='charset']/@value) = 'utf-8')</pd:xpath>
    </pd:transition>
</pd:ProcessDefinition>